{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal{transition:opacity .3s,transform .3s}.modal.show{opacity:1;transform:scale(1)}.modal.hidden{opacity:0;transform:scale(.95);pointer-events:none}
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-blue-900 mb-6 text-center">Create Your Account</h2>

    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <p class="text-sm {% if message.tags == 'success' %}text-green-500{% else %}text-red-500{% endif %} text-center">
                    {{ message }}
                </p>
            {% endfor %}
        </div>
    {% endif %}

    <form id="registration-form" method="POST" enctype="multipart/form-data" class="space-y-4" novalidate>
        {% csrf_token %}

        <!-- Username -->
        <div>
            <label class="block text-gray-700 font-semibold mb-1">
                {{ form.username.label }} <span class="text-red-500">*</span>
            </label>
            {{ form.username }}
            {% for error in form.username.errors %}
                <p class="text-sm text-red-500 mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <!-- First / Last Name -->
        <div>
            <label class="block text-gray-700 font-semibold mb-1">{{ form.first_name.label }}</label>
            {{ form.first_name }}
            {% for error in form.first_name.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <div>
            <label class="block text-gray-700 font-semibold mb-1">{{ form.last_name.label }}</label>
            {{ form.last_name }}
            {% for error in form.last_name.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <!-- Email -->
        <div>
            <label class="block text-gray-700 font-semibold mb-1">
                {{ form.email.label }} <span class="text-red-500">*</span>
            </label>
            {{ form.email }}
            {% for error in form.email.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <!-- Avatar -->
        <div>
            <label class="block text-gray-700 font-semibold mb-1">{{ form.avatar.label }}</label>
            {{ form.avatar }}
            {% for error in form.avatar.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <!-- Passwords -->
        <div>
            <label class="block text-gray-700 font-semibold mb-1">
                {{ form.password1.label }} <span class="text-red-500">*</span>
            </label>
            {{ form.password1 }}
            {% if form.password1.help_text %}
                <p class="text-xs text-gray-500 mt-1">{{ form.password1.help_text }}</p>
            {% endif %}
            {% for error in form.password1.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <div>
            <label class="block text-gray-700 font-semibold mb-1">
                {{ form.password2.label }} <span class="text-red-500">*</span>
            </label>
            {{ form.password2 }}
            <p id="password-match-error" class="text-sm text-red-500 mt-1 hidden">Passwords do not match.</p>
            {% for error in form.password2.errors %}<p class="text-sm text-red-500 mt-1">{{ error }}</p>{% endfor %}
        </div>

        <button type="submit"
                class="w-full bg-blue-900 text-white py-2 rounded-lg hover:bg-blue-800 transition-colors font-semibold">
            Register
        </button>
    </form>

    <p class="mt-4 text-center text-gray-600">
        Already have an account?
        <a href="{% url 'login' %}" class="text-blue-900 font-semibold hover:underline">Login</a>
    </p>
</div>

<!-- Modal (same as before) -->
<div id="result-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm modal">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center transform transition-all">
        <div id="modal-icon" class="mx-auto h-12 w-12 flex items-center justify-center rounded-full mb-4"></div>
        <h3 id="modal-title" class="text-xl font-bold text-gray-900"></h3>
        <p id="modal-message" class="mt-2 text-gray-600"></p>
        <button onclick="closeModal()"
                class="mt-5 px-5 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800 transition-colors font-medium">
            OK
        </button>
    </div>
</div>

<script>
    // (Keep the entire validation + modal script you already have â€“ it works unchanged)
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('registration-form');
        const password1 = document.getElementById('{{ form.password1.id_for_label }}');
        const password2 = document.getElementById('{{ form.password2.id_for_label }}');
        const passwordMatchError = document.getElementById('password-match-error');
        const modal = document.getElementById('result-modal');
        const modalIcon = document.getElementById('modal-icon');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        password2.addEventListener('input', () => {
            if (password1.value && password2.value && password1.value !== password2.value) {
                passwordMatchError.classList.remove('hidden');
            } else {
                passwordMatchError.classList.add('hidden');
            }
        });

        // ---- (rest of your validation code) ----
        // ... (you already have the full script)

        {% if messages %}
            {% for message in messages %}
                showModal(
                    "{% if message.tags == 'success' %}Success!{% else %}Error{% endif %}",
                    "{{ message }}",
                    "{{ message.tags }}"
                );
            {% endfor %}
        {% endif %}
    });
</script>
</body>
</html>